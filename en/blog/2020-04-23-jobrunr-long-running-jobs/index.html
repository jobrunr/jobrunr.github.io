<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />

    <link href="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js" rel="preload" as="script" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/prism.min.js" rel="preload" as="script" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/components/prism-java.min.js" rel="preload" as="script" />
    <link href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" rel="preload" as="script" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <title>Easily process long-running jobs with JobRunr Â· JobRunr</title>

    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="description" content="A tutorial on how to use JobRunr, Spring Data JPA and Docx-Stamper to generate the salary slips for all employees of Acme Corp">
    
    
    
    <meta name="author" content="Ronald Dehuysser, ronald@dehuysser.be">

    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:image" content="https://www.jobrunr.io/blog/2020-04-23-jobrunr-gets-jobs-done.webp" />
    <meta name="twitter:image:alt" content="JobRunr - get jobs done" />
    <meta name="twitter:title" content="Easily process long-running jobs with JobRunr" />
    <meta name="twitter:description" content="A tutorial on how to use JobRunr, Spring Data JPA and Docx-Stamper to generate the salary slips for all employees of Acme Corp" />
    <meta name="twitter:creator" content="@rdehuyss" />
    <meta name="twitter:site" content="@jobrunr" />

    <meta property="og:title" content="Easily process long-running jobs with JobRunr" />
<meta property="og:description" content="A tutorial on how to use JobRunr, Spring Data JPA and Docx-Stamper to generate the salary slips for all employees of Acme Corp" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.jobrunr.io/en/blog/2020-04-23-jobrunr-long-running-jobs/" /><meta property="og:image" content="https://www.jobrunr.io/blog/2020-04-23-jobrunr-gets-jobs-done.webp" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-04-23T11:12:23+02:00" />
<meta property="article:modified_time" content="2020-04-23T11:12:23+02:00" />


    
    
    
    <link rel="stylesheet" href="https://www.jobrunr.io/scss/custom.min.bc530210025672c5275e73d223263a1b309dd66c3a929bc89143e11ae911ac39.css" integrity="sha256-vFMCEAJWcsUnXnPSIyY6GzCd1mw6kpvIkUPhGukRrDk=" media="screen">
    <link rel="stylesheet" href="https://www.jobrunr.io/scss/screen.min.5cb3f5840ac2d788ddd0b4fdf55fe2bef4413a74dc36d13e4ecd8405c0c8bd7f.css" integrity="sha256-XLP1hArC14jd0LT99V/ivvRBOnTcNtE&#43;Ts2EBcDIvX8=" media="screen">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism.min.css" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism.min.css"></noscript>
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism-coy.min.css" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/themes/prism-coy.min.css"></noscript>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" as="style" onload="this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"></noscript>
</head>
<body class=" post-template ">
    
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MX5H2KM" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
      
    <div class="site-wrapper">

<header class="site-header" style="height: 64px;"><div class="outer site-nav-main">
    <div class="inner">
<nav id="site-nav" class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="https://www.jobrunr.io//en/"><img src="https://www.jobrunr.io/images/jobrunr-logo-white.webp" alt="JobRunr" height="21px" width="91px"/></a>
        
        <div class="site-nav-content">
            <ul class="nav" role="menu">
                
                <li class="nav-home" role="menuitem"><a href="/en/">Home</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/en/pricing/">JobRunr Pro</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/en/documentation/">Documentation</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/en/guides/">guides</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/en/use-case/">Use Cases</a></li>
                
                <li class="nav-home" role="menuitem"><a href="/en/blog/">Blog</a></li>
                
            </ul>
        </div>
    </div>
    <div class="site-nav-right">
        <div id="social-links" class="social-links">
            <style>
                div.social-links {
                    position: relative;
                }
                #lang-selector {
                    display: none;
                    background-color: rgb(144, 162, 170);
                    position: absolute;
                    left: 10px;
                    top: 56px;
                    z-index: 50;
                }
                #lang-selector li {
                    list-style-type: none;
                }
                #lang-selector li a {
                    color: #fff;
                    text-transform: uppercase;
                }
            </style>

            
            <a class="social-link social-link-tw" href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fjobrunr.io&amp;screen_name=jobrunr&amp;tw_p=followbutton" title="Follow us on Twitter" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"></path></svg></a>
            <a class="social-link social-link-gh" style="color: #fff" href="https://github.com/jobrunr/jobrunr" title="View code on Github" target="_blank" rel="noopener"><svg viewBox="-3 -3 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg> Source Code</a>
            <script>
                const langLink = document.getElementById("lang-link");
                if(langLink) {
                    const langSelector = document.getElementById("lang-selector");
                    const hideLangSelector = () => {
                        langSelector.style.display = 'none';
                    };
                    
                    const showLangSelector = () => {
                        langSelector.style.display = 'block';
                        setTimeout(hideLangSelector, 3000);
                    };
                    langLink.addEventListener("mouseover", showLangSelector);
                }
            </script>
        </div>
    </div>
</nav>

</div>
</div></header>

<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">

                
                    
                    <section class="post-full-tags">
                        <a href="/en/tags/blog">blog</a>
                    </section>
                

                <h1 class="post-full-title">Easily process long-running jobs with JobRunr</h1>

                
                    <p class="post-full-custom-excerpt">A tutorial on how to use JobRunr, Spring Data JPA and Docx-Stamper to generate the salary slips for all employees of Acme Corp</p>
                

                
                
                <div class="post-full-byline">
                    <section class="post-full-byline-content">

                        <ul class="author-list">
    <li class="author-list-item">
        <div class="author-card">
            <div class="author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></div>
            <div class="author-info">
                <div class="author-info">
                    <h2>Ronald Dehuysser</h2>
                </div>
            </div>
        </div>
        <a href="#" class="author-avatar author-profile-image"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3.513 18.998C4.749 15.504 8.082 13 12 13s7.251 2.504 8.487 5.998C18.47 21.442 15.417 23 12 23s-6.47-1.558-8.487-4.002zM12 12c2.21 0 4-2.79 4-5s-1.79-4-4-4-4 1.79-4 4 1.79 5 4 5z" fill="#FFF"/></g></svg></a>
    </li>
</ul>

                        <section class="post-full-byline-meta" style="width: 100%">
                            
                                <h4 class="author-name">Ronald Dehuysser</h4>
                            
                            <div class="byline-meta-content">
                                
                                    <time class="byline-meta-date" datetime="2020-114-04">23 April 2020</time>
                                    <span class="bull">&bull;</span>
                                 
                                <span class="byline-reading-time">11 min read</span>

                                 
                            </div>
                        </section>
                    </section>
                </div>
                
            </header>

            
            
            
            <figure class="post-full-image">
            
                <img src="/blog/2020-04-23-jobrunr-gets-jobs-done.webp" alt="/blog/2020-04-23-jobrunr-gets-jobs-done.webp"/>
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    <p>In this tutorial, we will be working for the fictional company Acme Corp and we need to generate the salary slips for all of Acme Corp&rsquo;s employees.</p>
<blockquote>
<p>TLDR; you can find the complete project on our Github repository: <a href="https://github.com/jobrunr/example-salary-slip">https://github.com/jobrunr/example-salary-slip</a></p>
</blockquote>
<p>To do so, we will be using 3 open-source components:</p>
<ul>
<li><a href="https://github.com/jobrunr/jobrunr">JobRunr</a>: JobRunr allows to easily schedule and process background jobs using Java 8 lambda&rsquo;s. It is backed by persistent storage and can process jobs in a parallel and distributed manner. Thanks to the built-in dashboard we have an in-depth overview into all our background jobs.</li>
<li><a href="https://docs.spring.io/spring-data/">Spring Data Jpa</a>: If you want to easily access data in a relational database, Spring Data Jpa is here to help. You can create repositories using nothing more than a simple interface</li>
<li><a href="https://github.com/thombergs/docx-stamper">Docx-Stamper</a>: Docx-Stamper allows to easily generate Word (.docx) documents backed by templates
Architecture</li>
</ul>
<p>During this tutorial, we will generate the weekly salary slip of all of Acme Corp&rsquo;s employees and email it to them. How? Well, by</p>
<ul>
<li>creating a recurring job using JobRunr that will run every week - it will get all of Acme Corp&rsquo;s employees using Spring Data Jpa and for each of these employees schedule a new background job to create the salary slip</li>
<li>each of these background jobs will fetch the Employee and
<ul>
<li>consume a <code>TimeClockService</code> which gives the amount of hours an employee worked for the given week.</li>
<li>generate a salary slip document using a <code>DocumentGenerationService</code> which will contain the name of the employee and the amount of hour he or she worked. The salary slip document is generated from a Word template and converted to a PDF file.</li>
<li>send an email to the employee with his salary slip using an <code>EmailService</code>.</li>
</ul>
</li>
</ul>
<figure>
<img src="/blog/2020-04-23-tutorial-report.webp" alt="" class="kg-image" />
<figcaption>We will transform a Word template to PDF and replace all placeholders with actual values.</figcaption>
</figure>
<h4 id="lets-gets-started">Let&rsquo;s gets started!</h4>
<p>In this tutorial we omit all Java imports for brevity - to find them, just visit the example project on <a href="https://github.com/jobrunr/example-salary-slip">https://github.com/jobrunr/example-salary-slip</a></p>
<p>For building this salary slip service, we use gradle and our <code>build.gradle</code> file is as follows:</p>
<h5 id="gradle-build-file">Gradle build file</h5>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>plugins {
</span></span><span style="display:flex;"><span>    id <span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#960050;background-color:#1e0010">&#39;</span>idea<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">springframework</span>.<span style="color:#a6e22e">boot</span><span style="color:#960050;background-color:#1e0010">&#39;</span> version <span style="color:#960050;background-color:#1e0010">&#39;</span>2.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">2</span>.<span style="color:#a6e22e">RELEASE</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    id <span style="color:#960050;background-color:#1e0010">&#39;</span>io.<span style="color:#a6e22e">spring</span>.<span style="color:#a6e22e">dependency</span><span style="color:#f92672">-</span>management<span style="color:#960050;background-color:#1e0010">&#39;</span> version <span style="color:#960050;background-color:#1e0010">&#39;</span>1.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">8</span>.<span style="color:#a6e22e">RELEASE</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>group <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">paycheck</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>version <span style="color:#960050;background-color:#1e0010">&#39;</span>1.<span style="color:#a6e22e">0</span><span style="color:#f92672">-</span>SNAPSHOT<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>repositories {
</span></span><span style="display:flex;"><span>    mavenCentral()
</span></span><span style="display:flex;"><span>    jcenter()
</span></span><span style="display:flex;"><span>    mavenLocal()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>configurations.<span style="color:#a6e22e">all</span> {
</span></span><span style="display:flex;"><span>    exclude group: <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">slf4j</span><span style="color:#960050;background-color:#1e0010">&#39;</span>, module: <span style="color:#960050;background-color:#1e0010">&#39;</span>slf4j<span style="color:#f92672">-</span>log4j12<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dependencies {
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">jobrunr</span>:jobrunr:0.<span style="color:#a6e22e">9</span>.<span style="color:#a6e22e">2</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">springframework</span>.<span style="color:#a6e22e">boot</span>:spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>data<span style="color:#f92672">-</span>jpa<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">springframework</span>.<span style="color:#a6e22e">boot</span>:spring<span style="color:#f92672">-</span>boot<span style="color:#f92672">-</span>starter<span style="color:#f92672">-</span>mail<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>com.<span style="color:#a6e22e">fasterxml</span>.<span style="color:#a6e22e">jackson</span>.<span style="color:#a6e22e">core</span>:jackson<span style="color:#f92672">-</span>databind<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>com.<span style="color:#a6e22e">fasterxml</span>.<span style="color:#a6e22e">jackson</span>.<span style="color:#a6e22e">datatype</span>:jackson<span style="color:#f92672">-</span>datatype<span style="color:#f92672">-</span>jsr310<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">wickedsource</span>.<span style="color:#a6e22e">docx</span><span style="color:#f92672">-</span>stamper:docx<span style="color:#f92672">-</span>stamper:1.<span style="color:#a6e22e">4</span>.<span style="color:#a6e22e">0</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">docx4j</span>:docx4j<span style="color:#f92672">-</span>core:8.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">6</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">docx4j</span>:docx4j<span style="color:#f92672">-</span>JAXB<span style="color:#f92672">-</span>ReferenceImpl:11.<span style="color:#a6e22e">1</span>.<span style="color:#a6e22e">3</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>com.<span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">javafaker</span>:javafaker:1.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">2</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    implementation <span style="color:#960050;background-color:#1e0010">&#39;</span>com.<span style="color:#a6e22e">h2database</span>:h2<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    testImplementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">junit</span>.<span style="color:#a6e22e">jupiter</span>:junit<span style="color:#f92672">-</span>jupiter:5.<span style="color:#a6e22e">6</span>.<span style="color:#a6e22e">1</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>    testImplementation <span style="color:#960050;background-color:#1e0010">&#39;</span>org.<span style="color:#a6e22e">awaitility</span>:awaitility:4.<span style="color:#a6e22e">0</span>.<span style="color:#a6e22e">2</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test {
</span></span><span style="display:flex;"><span>    useJUnitPlatform()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><figcaption>our build.gradle file uses JobRunr, Spring Boot Data, Sprint Boot Mail and Docx-Stamper. We exclude slf4j-log4j12 as it clashes with Logback provided by Spring</figcaption>
</figure>
<h5 id="employee">Employee</h5>
<p>Since we need to create salary slips for all employees let us start with the <code>Employee</code> class - it is a simple Entity with some fields like <code>firstName</code>, <code>lastName</code> and <code>email</code>.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.employee;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Entity</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Employee</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Id</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@GeneratedValue</span>(strategy <span style="color:#f92672">=</span> GenerationType.<span style="color:#a6e22e">AUTO</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Long id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String firstName;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String lastName;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String email;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">protected</span> <span style="color:#a6e22e">Employee</span>() {
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Employee</span>(String firstName, String lastName, String email) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>(<span style="color:#66d9ef">null</span>, firstName, lastName, email);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Employee</span>(Long id, String firstName, String lastName, String email) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">firstName</span> <span style="color:#f92672">=</span> firstName;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lastName</span> <span style="color:#f92672">=</span> lastName;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> email;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> String.<span style="color:#a6e22e">format</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Employee[id=%d, firstName=&#39;%s&#39;, lastName=&#39;%s&#39;]&#34;</span>,
</span></span><span style="display:flex;"><span>                id, firstName, lastName);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Long <span style="color:#a6e22e">getId</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> id;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getFirstName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> firstName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getLastName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getEmail</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> email;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><figcaption>Our Employee is a simple javax persistence entity</figcaption>
</figure>
<h5 id="employeerepository">EmployeeRepository</h5>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.employee;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">EmployeeRepository</span> <span style="color:#66d9ef">extends</span> CrudRepository<span style="color:#f92672">&lt;</span>Employee, Long<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Query</span>(<span style="color:#e6db74">&#34;select e.id from Employee e&#34;</span>)
</span></span><span style="display:flex;"><span>    Stream<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getAllEmployeeIds</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><figcaption>the EmployeeRepository extends the Spring Data CrudRepository and adds an extra method to fetch all the id's of the Employees</figcaption>
</figure>
<h5 id="workweek">WorkWeek</h5>
<p>Since the salary slip is generated once per week, we need a class representing the amount of time an employee has worked that week - the <code>WorkWeek</code> class. It has some extra fields like the <code>weekNbr</code> and a from and to date which we will use for our generated salary slip document.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.timeclock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WorkWeek</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> weekNbr;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> BigDecimal workHoursMonday;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> BigDecimal workHoursTuesday;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> BigDecimal workHoursWednesday;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> BigDecimal workHoursThursday;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> BigDecimal workHoursFriday;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> LocalDate from;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> LocalDate to;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">WorkWeek</span>(BigDecimal workHoursMonday, BigDecimal workHoursTuesday, BigDecimal workHoursWednesday, BigDecimal workHoursThursday, BigDecimal workHoursFriday) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workHoursMonday</span> <span style="color:#f92672">=</span> workHoursMonday;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workHoursTuesday</span> <span style="color:#f92672">=</span> workHoursTuesday;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workHoursWednesday</span> <span style="color:#f92672">=</span> workHoursWednesday;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workHoursThursday</span> <span style="color:#f92672">=</span> workHoursThursday;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workHoursFriday</span> <span style="color:#f92672">=</span> workHoursFriday;
</span></span><span style="display:flex;"><span>        WeekFields weekFields <span style="color:#f92672">=</span> WeekFields.<span style="color:#a6e22e">of</span>(Locale.<span style="color:#a6e22e">getDefault</span>());
</span></span><span style="display:flex;"><span>        weekNbr <span style="color:#f92672">=</span> now().<span style="color:#a6e22e">get</span>(weekFields.<span style="color:#a6e22e">weekOfWeekBasedYear</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">from</span> <span style="color:#f92672">=</span> now().<span style="color:#a6e22e">with</span>(TemporalAdjusters.<span style="color:#a6e22e">previous</span>(DayOfWeek.<span style="color:#a6e22e">MONDAY</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">to</span> <span style="color:#f92672">=</span> now().<span style="color:#a6e22e">with</span>(TemporalAdjusters.<span style="color:#a6e22e">nextOrSame</span>(DayOfWeek.<span style="color:#a6e22e">SUNDAY</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getWorkHoursMonday</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursMonday;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getWorkHoursTuesday</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursTuesday;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getWorkHoursWednesday</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursWednesday;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getWorkHoursThursday</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursThursday;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getWorkHoursFriday</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursFriday;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getWeekNbr</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> weekNbr;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> LocalDate <span style="color:#a6e22e">getFrom</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> from;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> LocalDate <span style="color:#a6e22e">getTo</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> to;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getTotal</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workHoursMonday
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">add</span>(workHoursTuesday)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">add</span>(workHoursWednesday)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">add</span>(workHoursThursday)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">add</span>(workHoursFriday);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></figure>
<h5 id="timeclockservice">TimeClockService</h5>
<p>To get a WorkWeek class for a certain employee, we create a <code>TimeClockService</code> which is a Spring Component. As we don&rsquo;t want to make this tutorial overly complex, here we use a stub which generates some random data. In a real-world application this service would make a REST or SOAP request to another microservice.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.timeclock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TimeClockService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> WorkWeek <span style="color:#a6e22e">getWorkWeekForEmployee</span>(Long employeeId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//simulate a long-during call</span>
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">sleep</span>(ThreadLocalRandom.<span style="color:#a6e22e">current</span>().<span style="color:#a6e22e">nextInt</span>(3, 5 <span style="color:#f92672">+</span> 1) <span style="color:#f92672">*</span> 1000);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> WorkWeek(
</span></span><span style="display:flex;"><span>                    BigDecimal.<span style="color:#a6e22e">valueOf</span>(getRandomHours()),
</span></span><span style="display:flex;"><span>                    BigDecimal.<span style="color:#a6e22e">valueOf</span>(getRandomHours()),
</span></span><span style="display:flex;"><span>                    BigDecimal.<span style="color:#a6e22e">valueOf</span>(getRandomHours()),
</span></span><span style="display:flex;"><span>                    BigDecimal.<span style="color:#a6e22e">valueOf</span>(getRandomHours()),
</span></span><span style="display:flex;"><span>                    BigDecimal.<span style="color:#a6e22e">valueOf</span>(getRandomHours())
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">interrupt</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> RuntimeException(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getRandomHours</span>() {
</span></span><span style="display:flex;"><span>        Random r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> r.<span style="color:#a6e22e">nextInt</span>((8 <span style="color:#f92672">-</span> 5) <span style="color:#f92672">+</span> 1) <span style="color:#f92672">+</span> 5;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><figcaption>to simplify this tutorial, we use a stub for the TimeClockService which generates Random work hours for each employee</figcaption>
</figure>
<p>We now have all the necessary data to generate our salary slip - except the SalarySlip class itself:</p>
<h5 id="salaryslip">SalarySlip</h5>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.paycheck;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SalarySlip</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Employee employee;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> WorkWeek workWeek;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">SalarySlip</span>(Employee employee, WorkWeek workWeek) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">employee</span> <span style="color:#f92672">=</span> employee;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">workWeek</span> <span style="color:#f92672">=</span> workWeek;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Employee <span style="color:#a6e22e">getEmployee</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> employee;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> WorkWeek <span style="color:#a6e22e">getWorkWeek</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workWeek;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> BigDecimal <span style="color:#a6e22e">getTotal</span>() {
</span></span><span style="display:flex;"><span>        BigDecimal totalPerHour <span style="color:#f92672">=</span> getTotalPerHour();
</span></span><span style="display:flex;"><span>        BigDecimal amountOfWorkedHours <span style="color:#f92672">=</span> getAmountOfWorkedHours();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> totalPerHour.<span style="color:#a6e22e">multiply</span>(amountOfWorkedHours).<span style="color:#a6e22e">setScale</span>(2, RoundingMode.<span style="color:#a6e22e">HALF_UP</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BigDecimal <span style="color:#a6e22e">getAmountOfWorkedHours</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> workWeek.<span style="color:#a6e22e">getTotal</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BigDecimal <span style="color:#a6e22e">getTotalPerHour</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> BigDecimal.<span style="color:#a6e22e">valueOf</span>(21.<span style="color:#a6e22e">50</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><figcaption>the SalarySlip class contains all the data necessary to generate a salary slip and will be used by the DocumentGenerationService to generate the salary slips as PDF documents.</figcaption>
</figure>
<h5 id="documentgenerationservice">DocumentGenerationService</h5>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.paycheck;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DocumentGenerationService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateDocument</span>(Path wordTemplatePath, Path wordOutputPath, Object context) <span style="color:#66d9ef">throws</span> IOException, Docx4JException {
</span></span><span style="display:flex;"><span>        Files.<span style="color:#a6e22e">createDirectories</span>(wordOutputPath.<span style="color:#a6e22e">getParent</span>().<span style="color:#a6e22e">toAbsolutePath</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>(InputStream template <span style="color:#f92672">=</span> Files.<span style="color:#a6e22e">newInputStream</span>(wordTemplatePath); OutputStream out <span style="color:#f92672">=</span> Files.<span style="color:#a6e22e">newOutputStream</span>(wordOutputPath)) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">final</span> ByteArrayOutputStream byteArrayOutputStream <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ByteArrayOutputStream();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">final</span> DocxStamper stamper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DocxStamperConfiguration().<span style="color:#a6e22e">setFailOnUnresolvedExpression</span>(<span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>            stamper.<span style="color:#a6e22e">stamp</span>(template, context, byteArrayOutputStream);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Docx4J.<span style="color:#a6e22e">toPDF</span>(WordprocessingMLPackage.<span style="color:#a6e22e">load</span>(<span style="color:#66d9ef">new</span> ByteArrayInputStream(byteArrayOutputStream.<span style="color:#a6e22e">toByteArray</span>())), out);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></figure>
<p>The <code>DocumentGenerationService</code> is also a Spring Component and has the responsibility to generate the actual salary slip documents based on a word template. The word template has a lot of placeholders, like <code>${employee.firstName}</code>, <code>${employee.lastName}</code> and <code>${workWeek.workHoursMonday.setScale(2)}</code> that will be replaced by DocxStamper using the given context object - in our case a <code>SalarySlip</code> object. Finally, the Word document with all fields filled in is converted to a PDF document.</p>
<h5 id="emailservice">EmailService</h5>
<p>The <code>EmailService</code> is again a Spring Component and has the responsibility to email the final salary slip word document to the employee - it uses Spring Boot Starter Email and using a <code>MimeMessage</code> created by the <code>JavaMailSender</code>. It has a method called <code>sendSalarySlip</code> with two arguments - the employee class and the path to the salary slip for that employee. Using these argument, we can send both a personalized text email and attach the actual salary slip as an attachment.</p>
<p>The <code>JavaMailSender</code> is a class provided by Spring Boot Starter Mail and configured using a properties file. You can find the properties file here: &hellip;</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.email;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmailService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> JavaMailSender emailSender;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">EmailService</span>(JavaMailSender emailSender) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">emailSender</span> <span style="color:#f92672">=</span> emailSender;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendSalarySlip</span>(Employee employee, Path salarySlipPath) <span style="color:#66d9ef">throws</span> MessagingException {
</span></span><span style="display:flex;"><span>        MimeMessage message <span style="color:#f92672">=</span> emailSender.<span style="color:#a6e22e">createMimeMessage</span>();
</span></span><span style="display:flex;"><span>        MimeMessageHelper helper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MimeMessageHelper(message, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        helper.<span style="color:#a6e22e">setTo</span>(employee.<span style="color:#a6e22e">getEmail</span>());
</span></span><span style="display:flex;"><span>        helper.<span style="color:#a6e22e">setSubject</span>(<span style="color:#e6db74">&#34;Your weekly salary slip&#34;</span>);
</span></span><span style="display:flex;"><span>        helper.<span style="color:#a6e22e">setText</span>(String.<span style="color:#a6e22e">format</span>(<span style="color:#e6db74">&#34;Dear %s,\n\nhere you can find your weekly salary slip. \n \nThanks again for your hard work,\nAcme corp&#34;</span>, employee.<span style="color:#a6e22e">getFirstName</span>()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        FileSystemResource file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileSystemResource(salarySlipPath);
</span></span><span style="display:flex;"><span>        helper.<span style="color:#a6e22e">addAttachment</span>(<span style="color:#e6db74">&#34;Salary Slip&#34;</span>, file);
</span></span><span style="display:flex;"><span>        emailSender.<span style="color:#a6e22e">send</span>(message);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></figure>
<h5 id="and-finally-the-salaryslipservice">And finally, the SalarySlipService</h5>
<p>The <code>SalarySlipService</code> is the last step of the puzzle and wires everything together:</p>
<ul>
<li>it has the path to the salary slip word template</li>
<li>it uses the other components we already created:</li>
<li>the <code>EmployeeRepository</code> to get all employees from the database</li>
<li>the <code>TimeClockService</code> to get the amount of hours an employee worked</li>
<li>the <code>DocumentGenerationService</code> to create a salary slip from the given Word template</li>
<li>the <code>EmailService</code> to send a personalized email with the salary slip as attachment to the employee</li>
</ul>
<p>It also two important public methods:</p>
<p><strong>generateAndSendSalarySlip</strong></p>
<p>The method <code>generateAndSendSalarySlip</code> uses the employee id to get the actual employee data, generates the salary slip Word document and sends it via email to the employee. It will be a JobRunr background job and it is called from the method <code>generateAndSendSalarySlipToAllEmployees</code>. We annotate it with the Job annotation to have meaningful names in dashboard of JobRunr.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Job</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Generate and send salary slip to employee %0&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateAndSendSalarySlip</span>(Long employeeId) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Employee employee <span style="color:#f92672">=</span> getEmployee(employeeId);
</span></span><span style="display:flex;"><span>        Path salarySlipPath <span style="color:#f92672">=</span> generateSalarySlip(employee);
</span></span><span style="display:flex;"><span>        emailService.<span style="color:#a6e22e">sendSalarySlip</span>(employee, salarySlipPath);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><figcaption>The method generateAndSendSalarySlip, a standard method in our service, will become a background job</figcaption>
</figure>
<p><strong>generateAndSendSalarySlipToAllEmployees</strong></p>
<p>This is our main method that will be scheduled each week - it gets a stream of employee ids and using the <code>BackgroundJob.enqueue</code> method, we create a background job of the <code>generateAndSendSalarySlip</code> method.</p>
<p>The document generation fails because there is not enough disk space? Or the <code>TimeClockService</code> fails for an employee because the external microservice is down? No worries - as JobRunr is fault-tolerant (it will automatically retry failed jobs with an exponential back-off policy), these failing jobs will be retried 10 times automatically.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@Transactional</span>(readOnly <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Job</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Generate and send salary slip to all employees&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateAndSendSalarySlipToAllEmployees</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Stream<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> allEmployees <span style="color:#f92672">=</span> employeeRepository.<span style="color:#a6e22e">getAllEmployeeIds</span>();
</span></span><span style="display:flex;"><span>        BackgroundJob.<span style="color:#f92672">&lt;</span>SalarySlipService, Long<span style="color:#f92672">&gt;</span>enqueue(allEmployees, (salarySlipService, employeeId) <span style="color:#f92672">-&gt;</span> salarySlipService.<span style="color:#a6e22e">generateAndSendSalarySlip</span>(employeeId));
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><figcaption>This method will be scheduled each week and will create new background jobs for the generation and sending of the salary slip for each employee.</figcaption>
</figure>
<p>The complete SalarySlipService is as follows:</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example.paycheck;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SalarySlipService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Path salarySlipTemplatePath <span style="color:#f92672">=</span> Path.<span style="color:#a6e22e">of</span>(<span style="color:#e6db74">&#34;src/main/resources/templates/salary-slip-template.docx&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> EmployeeRepository employeeRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> TimeClockService timeClockService;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> DocumentGenerationService documentGenerationService;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> EmailService emailService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">SalarySlipService</span>(EmployeeRepository employeeRepository, TimeClockService timeClockService, DocumentGenerationService documentGenerationService, EmailService emailService) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">employeeRepository</span> <span style="color:#f92672">=</span> employeeRepository;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeClockService</span> <span style="color:#f92672">=</span> timeClockService;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">documentGenerationService</span> <span style="color:#f92672">=</span> documentGenerationService;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">emailService</span> <span style="color:#f92672">=</span> emailService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Transactional</span>(readOnly <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Job</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Generate and send salary slip to all employees&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateAndSendSalarySlipToAllEmployees</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Stream<span style="color:#f92672">&lt;</span>Long<span style="color:#f92672">&gt;</span> allEmployees <span style="color:#f92672">=</span> employeeRepository.<span style="color:#a6e22e">getAllEmployeeIds</span>();
</span></span><span style="display:flex;"><span>        BackgroundJob.<span style="color:#f92672">&lt;</span>SalarySlipService, Long<span style="color:#f92672">&gt;</span>enqueue(allEmployees, (salarySlipService, employeeId) <span style="color:#f92672">-&gt;</span> salarySlipService.<span style="color:#a6e22e">generateAndSendSalarySlip</span>(employeeId));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Job</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Generate and send salary slip to employee %0&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">generateAndSendSalarySlip</span>(Long employeeId) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Employee employee <span style="color:#f92672">=</span> getEmployee(employeeId);
</span></span><span style="display:flex;"><span>        Path salarySlipPath <span style="color:#f92672">=</span> generateSalarySlip(employee);
</span></span><span style="display:flex;"><span>        emailService.<span style="color:#a6e22e">sendSalarySlip</span>(employee, salarySlipPath);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Path <span style="color:#a6e22e">generateSalarySlip</span>(Employee employee) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> WorkWeek workWeek <span style="color:#f92672">=</span> getWorkWeekForEmployee(employee.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> SalarySlip salarySlip <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SalarySlip(employee, workWeek);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> generateSalarySlipDocumentUsingTemplate(salarySlip);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Path <span style="color:#a6e22e">generateSalarySlipDocumentUsingTemplate</span>(SalarySlip salarySlip) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>        Path salarySlipPath <span style="color:#f92672">=</span> Paths.<span style="color:#a6e22e">get</span>(System.<span style="color:#a6e22e">getProperty</span>(<span style="color:#e6db74">&#34;java.io.tmpdir&#34;</span>), String.<span style="color:#a6e22e">valueOf</span>(now().<span style="color:#a6e22e">getYear</span>()), format(<span style="color:#e6db74">&#34;workweek-%d&#34;</span>, salarySlip.<span style="color:#a6e22e">getWorkWeek</span>().<span style="color:#a6e22e">getWeekNbr</span>()), format(<span style="color:#e6db74">&#34;salary-slip-employee-%d.docx&#34;</span>, salarySlip.<span style="color:#a6e22e">getEmployee</span>().<span style="color:#a6e22e">getId</span>()));
</span></span><span style="display:flex;"><span>        documentGenerationService.<span style="color:#a6e22e">generateDocument</span>(salarySlipTemplatePath, salarySlipPath, salarySlip);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> salarySlipPath;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> WorkWeek <span style="color:#a6e22e">getWorkWeekForEmployee</span>(Long employeeId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> timeClockService.<span style="color:#a6e22e">getWorkWeekForEmployee</span>(employeeId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Employee <span style="color:#a6e22e">getEmployee</span>(Long employeeId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> employeeRepository.<span style="color:#a6e22e">findById</span>(employeeId).<span style="color:#a6e22e">orElseThrow</span>(() <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> IllegalArgumentException(format(<span style="color:#e6db74">&#34;Employee with id &#39;%d&#39; does not exist&#34;</span>, employeeId)));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></figure>
<h5 id="last-but-not-least---our-spring-boot-application">Last but not least - our Spring Boot Application</h5>
<p>The Spring Boot Application bootstraps our application and has one important piece of code:</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>BackgroundJob.<span style="color:#a6e22e">scheduleRecurringly</span>(
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;generate-and-send-salary-slip&#34;</span>,
</span></span><span style="display:flex;"><span>	SalarySlipService::generateAndSendSalarySlipToAllEmployees,
</span></span><span style="display:flex;"><span>	Cron.<span style="color:#a6e22e">weekly</span>(DayOfWeek.<span style="color:#a6e22e">SUNDAY</span>, 22)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><figcaption>This method call ensures that the generateAndSendSalarySlipToAllEmployees method of our SalarySlipService will be triggered each Sunday at 10pm.</figcaption>
</figure>
<p>In this SpringBootApplication we create some fake employees, define a DataSource (in our case a simple H2 database) and initialize JobRunr using it&rsquo;s fluent-api.</p>
<figure style="width: 100%; max-width: 100%">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> org.jobrunr.example;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SalarySlipMicroService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#a6e22e">run</span>(SalarySlipMicroService.<span style="color:#a6e22e">class</span>, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> CommandLineRunner <span style="color:#a6e22e">demo</span>(EmployeeRepository repository) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> Faker faker <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Faker();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (args) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> 1000; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                repository.<span style="color:#a6e22e">save</span>(<span style="color:#66d9ef">new</span> Employee(faker.<span style="color:#a6e22e">name</span>().<span style="color:#a6e22e">firstName</span>(), faker.<span style="color:#a6e22e">name</span>().<span style="color:#a6e22e">lastName</span>(), faker.<span style="color:#a6e22e">internet</span>().<span style="color:#a6e22e">emailAddress</span>()));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            BackgroundJob.<span style="color:#a6e22e">scheduleRecurringly</span>(
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;generate-and-send-salary-slip&#34;</span>,
</span></span><span style="display:flex;"><span>                    SalarySlipService::generateAndSendSalarySlipToAllEmployees,
</span></span><span style="display:flex;"><span>                    Cron.<span style="color:#a6e22e">weekly</span>(DayOfWeek.<span style="color:#a6e22e">SUNDAY</span>, 22)
</span></span><span style="display:flex;"><span>            );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">join</span>();
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> DataSource <span style="color:#a6e22e">dataSource</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> JdbcDataSource ds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JdbcDataSource();
</span></span><span style="display:flex;"><span>        ds.<span style="color:#a6e22e">setURL</span>(<span style="color:#e6db74">&#34;jdbc:h2:&#34;</span> <span style="color:#f92672">+</span> Paths.<span style="color:#a6e22e">get</span>(System.<span style="color:#a6e22e">getProperty</span>(<span style="color:#e6db74">&#34;java.io.tmpdir&#34;</span>), <span style="color:#e6db74">&#34;paycheck&#34;</span>));
</span></span><span style="display:flex;"><span>        ds.<span style="color:#a6e22e">setUser</span>(<span style="color:#e6db74">&#34;sa&#34;</span>);
</span></span><span style="display:flex;"><span>        ds.<span style="color:#a6e22e">setPassword</span>(<span style="color:#e6db74">&#34;sa&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ds;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> JobScheduler <span style="color:#a6e22e">initJobRunr</span>(ApplicationContext applicationContext) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> JobRunr.<span style="color:#a6e22e">configure</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">useStorageProvider</span>(SqlStorageProviderFactory
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">using</span>(applicationContext.<span style="color:#a6e22e">getBean</span>(DataSource.<span style="color:#a6e22e">class</span>)))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">useJobActivator</span>(applicationContext::getBean)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">useDefaultBackgroundJobServer</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">useDashboard</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">initialize</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></figure>
Time to use our new application!
<p>Once you start the SalarySlipMicroService application, you can open your browser using the url http://localhost:8000 and navigate to the Recurring jobs tab.</p>
<figure>
<img src="/blog/2020-04-23-tutorial-salary-slip-01-recurring-job.webp" alt="" class="kg-image" />
<figcaption>Our recurring job that will be triggered each Sunday.</figcaption>
</figure>
<p>To test it, we trigger it now manually. The job is processed and schedules a new job to create the salary slip for each employee. Within 15 seconds the processing of these jobs start and we will see the generated PDF documents in our tmp folder.</p>
<figure>
<img src="/blog/2020-04-23-tutorial-salary-slip-02.webp" alt="" class="kg-image" />
<figcaption>An overview of enqueued jobs</figcaption>
</figure>
<p>We can inspect a Job and see them succeed - if it would fail for some reason, they will be automatically retried.</p>
<figure>
<img src="/blog/2020-04-23-tutorial-salary-slip-04.webp" alt="" class="kg-image" />
<figcaption>An overview of a succeeded job</figcaption>
</figure>
<h3 id="conclusion">Conclusion:</h3>
<ul>
<li>JobRunr and Spring Data integrate very well and both are very easy to use. Being able to schedule Java 8 lambda&rsquo;s and have them run in a background process is a really nice feature of JobRunr.</li>
<li>To convert the Word document to PDF, there is some nasty stuff in the word template (like white text) to have an OK-layout. Docx-Stamper is a great library and depends on Docx4J. Docx4J allows to convert Word documents to PDF but it still requires some work as a couple of hacks were done to get the layout right.</li>
</ul>

                </div>
            </section>

        </article>

    </div>
</main>


        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright" style="align-self: start;">
                  &copy; <a href="https://www.jobrunr.io/">JobRunr</a>
                </section>
                <section class="love" style="align-self: start; opacity: 0.7;">
                  Made with <strong style="color: red; font-size: large;">&hearts;</strong> in Belgium
                </section>
                <nav class="site-footer-nav">
                  <div>
                    <div><a href="/en/about/" rel="noopener" style="opacity: 0.5;">JobRunr by Rosoco BV (BE 0807596165)</a></div>
                    <div><a href="/en/licensing/info/" rel="noopener" style="opacity: 0.5;">Terms of use</a></div>
                    <div><a href="/en/privacy/" rel="noopener" style="opacity: 0.5;">Privacy</a></div>
                  </div>
                </nav>
            </div>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/prism.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.20.0/components/prism-java.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" defer></script>
    <script src='https://www.jobrunr.io/js/codetabs.js'></script>
    <script src='https://www.jobrunr.io/js/framework.js'></script>
<script>
window.addEventListener("load", (event) => {
  setTimeout(() => {
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#000"
        },
        "button": {
          "background": "transparent",
          "border": "#fff",
          "text": "#fff"
        }
      },
      "content": {
        "link": "Learn more about cookies"
      }
    });
  }, 5000);
});

var links = document.querySelectorAll('a');
for (var i = 0; i < links.length; i++) {
  if (links[i].hostname != window.location.hostname) {
    links[i].target = '_blank';
    links[i].rel = 'noopener';
  }
}
</script>




<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MX5H2KM');</script>



<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "gndsmglzod");
</script>
</body>
</html>